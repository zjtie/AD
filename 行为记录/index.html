  <!DOCTYPE html>
<html lang="zh-CN" class="h-full">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>è¡Œä¸ºè®°å½• Â· Behavior Journal</title>
  <link rel="stylesheet" href="assets/style.css">
  <!--ç½‘é¡µæ ·å¼æ–‡ä»¶ -->

  <!-- Tailwind CDNï¼ˆå¼€å‘/æœ¬åœ°é¢„è§ˆè¶³å¤Ÿï¼Œæ­£å¼å¯æ”¹ CLIï¼‰ -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: { ink: { 800:'#222326', 900:'#17181a' } },
          boxShadow: { soft: '0 1px 2px rgba(0,0,0,0.08), 0 8px 24px rgba(0,0,0,0.12)' }
        }
      }
    };
  </script>
  <style>
    ::selection{ background:#c7d2fe; color:#111827; }
    .thin-scrollbar::-webkit-scrollbar{ width:8px; height:8px; }
    .thin-scrollbar::-webkit-scrollbar-thumb{ background:rgba(100,116,139,.45); border-radius:9999px; }
    .dark .thin-scrollbar::-webkit-scrollbar-thumb{ background:rgba(148,163,184,.35); }
    .frost { backdrop-filter: saturate(140%) blur(10px); -webkit-backdrop-filter: saturate(140%) blur(10px); }
    /* å¯é€‰ blur å€¼ï¼šâœ¨ ç£¨ç ‚æ¨¡ç³Šæ•ˆæœï¼ˆå¯é€‰å¢å¼ºï¼‰
    - blur(6px)ï¼šè½»å¾®æ¨¡ç³Š
    - blur(10px)ï¼šæ ‡å‡†æ¨¡ç³Š âœ… æ¨è
    - blur(14px)ï¼šå¢å¼ºç£¨ç ‚
    - blur(20px)ï¼šæè‡´æ¨¡ç³Š
  */
    .glass { background: rgba(255,255,255,0.95); }
    /* å¯é€‰å€¼ï¼šğŸŒ¤ æµ…è‰²æ¨¡å¼ä¸‹çš„ç£¨ç ‚é¢æ¿èƒŒæ™¯ï¼ˆå¦‚è¡¨å•ã€å¡ç‰‡ã€å¼¹çª—ï¼‰
    - 0.60ï¼šé€šé€ç£¨ç ‚ï¼ˆé»˜è®¤ï¼‰
    - 0.75ï¼šé€‚ä¸­ç£¨ç ‚
    - 0.85ï¼šåå®è‰²ç£¨ç ‚ âœ… æ¨è
    - 1.00ï¼šçº¯ç™½ä¸é€æ˜
    */
    .glass-dark { background: rgba(23,24,26,0.95); }
    /* å¯é€‰å€¼ï¼šğŸŒ‘ æš—è‰²æ¨¡å¼ä¸‹çš„ç£¨ç ‚é¢æ¿èƒŒæ™¯
        - 0.50ï¼šé€šé€æš—é»‘ï¼ˆé»˜è®¤ï¼‰
        - 0.65ï¼šé€‚ä¸­æš—é»‘
        - 0.75ï¼šæ²‰ç¨³æš—é»‘ âœ… æ¨è
        - 0.90ï¼šæ¥è¿‘çº¯é»‘
      */
    .card-actions{ opacity:0; transition:opacity .15s ease; }
    .record-card:hover .card-actions, .record-card:focus-within .card-actions{ opacity:1; }
    .btn { @apply px-3 py-1.5 text-sm rounded-lg border border-white/60 dark:border-white/10 glass dark:glass-dark hover:bg-white/70 dark:hover:bg-white/10 text-zinc-800 dark:text-zinc-100; }
    .btn-primary { @apply px-3 py-1.5 text-sm rounded-lg bg-zinc-900/90 text-white dark:bg-white/90 dark:text-zinc-900 hover:opacity-90 shadow-soft; }
    .btn-icon { @apply p-2 rounded-lg border border-white/60 dark:border-white/10 glass dark:glass-dark hover:bg-white/70 dark:hover:bg-white/10; }
    .btn-sm { @apply px-2 py-1 text-xs rounded border border-white/60 dark:border-white/10 glass dark:glass-dark hover:bg-white/70 dark:hover:bg-white/10; }
  </style>

  <!-- Vue 3 -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>

  <!-- Favicon å ä½é¿å… 404 -->
  <link rel="icon" href="data:,">
</head>

<body class="h-full bg-[url('https://images.unsplash.com/photo-1496307042754-b4aa456c4a2d?q=80&w=1600&auto=format&fit=crop')] bg-cover bg-fixed">
  <!-- èƒŒæ™¯å›¾ç‰‡ -->

  <div id="app" class="min-h-full flex flex-col bg-white/60 dark:bg-black/50 frost">

    <!-- é¡¶æ ï¼ˆæµ®åŠ¨é¢æ¿å…¥å£ï¼‰ -->
    <header class="sticky top-0 z-30 border-b border-white/40 dark:border-white/10 frost">
      <div class="mx-auto max-w-[1400px] px-3 sm:px-6 lg:px-8 py-3 flex items-center gap-3">
        <div class="flex items-center gap-2">
          <div class="h-8 w-8 rounded-lg glass dark:glass-dark flex items-center justify-center shadow-soft border border-white/60 dark:border-white/10">
            <span class="text-sm font-bold text-zinc-800 dark:text-zinc-100">BJ</span>
          </div>
          <h1 class="text-lg font-semibold tracking-tight text-zinc-800 dark:text-zinc-100">è¡Œä¸ºè®°å½•</h1>
        </div>

        <div class="ml-auto flex flex-wrap items-center gap-2">
          <!-- æµ®åŠ¨é¢æ¿è§¦å‘æŒ‰é’® -->
          <button @click="ui.showDataPanel = !ui.showDataPanel" class="btn">æ•°æ®å·¥å…·</button>
          <button @click="ui.showCalendarPanel = !ui.showCalendarPanel" class="btn">ç­›é€‰ / æ—¥å†</button>

          <button @click="toggleDark()" class="btn-icon" :title="settings.dark ? 'åˆ‡æ¢ä¸ºäº®è‰²' : 'åˆ‡æ¢ä¸ºæš—è‰²'">
            <svg v-if="!settings.dark" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-zinc-800" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 3v2m0 14v2m9-9h-2M5 12H3m15.364 6.364-1.414-1.414M7.05 7.05 5.636 5.636m12.728 0L16.95 7.05M7.05 16.95l-1.414 1.414M16 12a4 4 0 1 1-8 0 4 0 0 1 8 0z" />
            </svg>
            <svg v-else xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-zinc-100" viewBox="0 0 24 24" fill="currentColor">
              <path d="M21.64 13.64A9 9 0 1 1 10.36 2.36a7 7 0 1 0 11.28 11.28z"/>
            </svg>
          </button>
          <button @click="syncNow" class="btn-primary">åŒæ­¥</button>
          <button @click="ui.showSettings = true" class="btn">è®¾ç½®</button>
        </div>
      </div>
    </header>

    <!-- æµ®åŠ¨é¢æ¿ï¼šæ•°æ®å·¥å…· -->
    <div v-show="ui.showDataPanel" class="fixed top-14 right-3 z-40 w-[min(92vw,480px)]">
      <div class="rounded-2xl glass dark:glass-dark border border-white/60 dark:border-white/10 p-3 shadow-soft">
        <div class="flex items-center justify-between mb-2">
          <div class="text-sm font-medium text-zinc-800 dark:text-zinc-100">æ•°æ®æ“ä½œ</div>
          <button class="btn-sm" @click="ui.showDataPanel=false">å…³é—­</button>
        </div>
        <div class="grid grid-cols-2 gap-2">
          <button @click="exportJSON" class="btn">å¯¼å‡º JSON</button>
          <button @click="exportCSV" class="btn">å¯¼å‡º CSV</button>
          <input ref="importInput" type="file" accept=".json" class="hidden" @change="importJSON">
          <button @click="$refs.importInput.click()" class="btn">å¯¼å…¥ JSON</button>
          <button @click="backupAll" class="btn">å¤‡ä»½</button>
          <input ref="restoreInput" type="file" accept=".bjbak,.json" class="hidden" @change="restoreBackup">
          <button @click="$refs.restoreInput.click()" class="btn">æ¢å¤</button>
          <button @click="clearAll" class="btn text-red-600 border-red-300">æ¸…ç©º</button>
        </div>
        <div class="mt-2 text-xs text-zinc-700 dark:text-zinc-300">
          æç¤ºï¼šCSV å« UTF-8 BOMï¼Œæ”¯æŒä¸­æ–‡ï¼›JSON å¯¼å…¥æ”¯æŒ \uXXXX è§£ç ã€‚
        </div>
      </div>
    </div>

    <!-- æµ®åŠ¨é¢æ¿ï¼šç­›é€‰ + æ—¥å†ï¼ˆå°è§†å›¾ï¼‰ -->
    <div v-show="ui.showCalendarPanel" class="fixed top-14 left-1/2 -translate-x-1/2 z-40 w-[min(96vw,820px)]">
      <div class="rounded-2xl glass dark:glass-dark border border-white/60 dark:border-white/10 p-3 shadow-soft">
        <div class="flex items-center justify-between">
          <div class="text-sm font-medium text-zinc-800 dark:text-zinc-100">ç­›é€‰ / æ—¥å†</div>
          <button class="btn-sm" @click="ui.showCalendarPanel=false">å…³é—­</button>
        </div>
        <div class="mt-2 grid grid-cols-1 md:grid-cols-4 gap-2">
          <div class="flex items-center gap-2">
            <label class="text-xs text-zinc-700 dark:text-zinc-300">å¼€å§‹</label>
            <input type="date" v-model="filters.startDate" class="w-full rounded-lg glass dark:glass-dark border border-white/60 dark:border-white/10 px-2 py-1.5 text-sm text-zinc-800 dark:text-zinc-100">
          </div>
          <div class="flex items-center gap-2">
            <label class="text-xs text-zinc-700 dark:text-zinc-300">ç»“æŸ</label>
            <input type="date" v-model="filters.endDate" class="w-full rounded-lg glass dark:glass-dark border border-white/60 dark:border-white/10 px-2 py-1.5 text-sm text-zinc-800 dark:text-zinc-100">
          </div>
          <div>
            <input placeholder="è¡Œä¸ºç±»å‹" v-model.trim="filters.type" class="w-full rounded-lg glass dark:glass-dark border border-white/60 dark:border-white/10 px-2 py-1.5 text-sm text-zinc-800 dark:text-zinc-100">
          </div>
          <div class="flex gap-2">
            <input placeholder="æ ‡ç­¾å…³é”®è¯ï¼ˆé€—å·åˆ†éš”ï¼‰" v-model.trim="filters.tagKeywords" class="flex-1 rounded-lg glass dark:glass-dark border border-white/60 dark:border-white/10 px-2 py-1.5 text-sm text-zinc-800 dark:text-zinc-100">
            <button @click="applyFilters" class="btn-primary">ç­›é€‰</button>
          </div>
        </div>

        <!-- æ—¥å†ï¼šå°è§†å›¾ï¼Œè‡ªé€‚åº” -->
        <div class="mt-3 rounded-xl p-3 glass dark:glass-dark border border-white/60 dark:border-white/10">
          <div class="flex justify-between items-center mb-2">
            <div class="text-sm font-medium text-zinc-800 dark:text-zinc-100">{{ calendar.year }} å¹´ {{ calendar.month+1 }} æœˆ</div>
            <div class="flex gap-1">
              <button @click="calendarPrev" class="btn-sm">â†</button>
              <button @click="calendarNext" class="btn-sm">â†’</button>
              <button @click="calendarToday" class="btn-sm">ä»Šå¤©</button>
            </div>
          </div>
          <div class="grid grid-cols-7 gap-1 text-xs text-zinc-600 dark:text-zinc-300">
            <div class="py-1 text-center">ä¸€</div><div class="py-1 text-center">äºŒ</div><div class="py-1 text-center">ä¸‰</div>
            <div class="py-1 text-center">å››</div><div class="py-1 text-center">äº”</div><div class="py-1 text-center">å…­</div><div class="py-1 text-center">æ—¥</div>
          </div>
          <div class="grid grid-cols-7 gap-1 mt-1">
            <button v-for="cell in calendar.cells" :key="cell.key"
                    @click="selectCalendarDay(cell)"
                    :class="[
                      'aspect-square rounded-lg border text-sm flex flex-col items-center justify-center relative',
                      'hover:bg-white/60 dark:hover:bg-white/10',
                      cell.out ? 'opacity-40' : '',
                      cell.selected ? 'ring-2 ring-blue-400/70' : '',
                      'glass dark:glass-dark border-white/60 dark:border-white/10'
                    ]">
              <span class="text-zinc-900 dark:text-zinc-100">{{ cell.day }}</span>
              <span v-if="cell.count>0" class="absolute bottom-1.5 inline-flex items-center justify-center text-[10px] px-1.5 py-0.5 rounded-full bg-zinc-900/90 text-white dark:bg-white/90 dark:text-zinc-900">
                {{ cell.count }}
              </span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- ä¸»ä½“ -->
    <main class="mx-auto max-w-[1400px] w-full flex-1 px-3 sm:px-6 lg:px-8 py-6 grid grid-cols-1 xl:grid-cols-2 gap-6">

      <!-- å·¦ï¼šè¡¨å• -->
      <section class="space-y-4">
        <div class="rounded-2xl glass dark:glass-dark border border-white/60 dark:border-white/10 overflow-hidden shadow-soft">
          <!-- ç»„A -->
          <div class="p-4 sm:p-6 bg-white/50 dark:bg-black/30">
            <div class="grid grid-cols-3 gap-2 sm:gap-3">
              <div class="flex items-center gap-2 min-w-0">
                <button type="button" class="text-xs text-zinc-600 dark:text-zinc-300 select-none" @click="fillNow('start')">å¼€å§‹</button>
                <input type="time" v-model="form.startTime" @change="recomputeDuration" class="w-full rounded-lg glass dark:glass-dark border border-white/60 dark:border-white/10 px-2 py-2 text-zinc-800 dark:text-zinc-100">
              </div>
              <div class="flex items-center gap-2 min-w-0">
                <button type="button" class="text-xs text-zinc-600 dark:text-zinc-300 select-none" @click="fillNow('end')">ç»“æŸ</button>
                <input type="time" v-model="form.endTime" @change="recomputeDuration" class="w-full rounded-lg glass dark:glass-dark border border-white/60 dark:border-white/10 px-2 py-2 text-zinc-800 dark:text-zinc-100">
              </div>
              <div class="flex items-center gap-2 min-w-0">
                <span class="text-xs text-zinc-600 dark:text-zinc-300">è€—æ—¶</span>
                <input type="text" :value="humanDurationText" readonly class="w-full rounded-lg glass dark:glass-dark border border-white/60 dark:border-white/10 px-2 py-2 text-zinc-800 dark:text-zinc-100">
              </div>
            </div>

            <div class="grid grid-cols-2 gap-2 sm:gap-3 mt-3">
              <div>
                <label class="text-xs text-zinc-600 dark:text-zinc-300">è¡Œä¸ºç±»å‹</label>
                <select v-model="form.type" class="mt-1 w-full rounded-lg glass dark:glass-dark border border-white/60 dark:border-white/10 px-2 py-2 text-zinc-800 dark:text-zinc-100">
                  <option>å­¦ä¹ </option><option>å·¥ä½œ</option><option>å¨±ä¹</option><option>åæ€</option>
                </select>
              </div>
              <div>
                <label class="text-xs text-zinc-600 dark:text-zinc-300">æ ‡ç­¾ï¼ˆé€—å·åˆ†éš”ï¼Œè‡ªåŠ¨è¡¥å…¨ï¼‰</label>
                <input v-model="form.tagsInput" @input="onTagsInput" list="tag-suggest" placeholder="å¦‚ï¼šè‹±è¯­, é˜…è¯»"
                       class="mt-1 w-full rounded-lg glass dark:glass-dark border border-white/60 dark:border-white/10 px-2 py-2 text-zinc-800 dark:text-zinc-100">
                <datalist id="tag-suggest"><option v-for="t in tagSuggestions" :key="t" :value="t"></option></datalist>
              </div>
            </div>

            <div class="grid grid-cols-2 gap-2 sm:gap-3 mt-3">
              <div>
                <label class="text-xs text-zinc-600 dark:text-zinc-300">æ—¥æœŸ</label>
                <input type="date" v-model="form.date" class="mt-1 w-full rounded-lg glass dark:glass-dark border border-white/60 dark:border-white/10 px-2 py-2 text-zinc-800 dark:text-zinc-100">
              </div>
              <div class="flex items-end">
                <button @click="ui.showEventModal = true" class="w-full rounded-lg glass dark:glass-dark border border-white/60 dark:border-white/10 px-2 py-2 hover:bg-white/60 dark:hover:bg-white/10 text-left">
                  <div class="text-xs text-zinc-600 dark:text-zinc-300">äº‹ä»¶ä¿¡æ¯</div>
                  <div class="text-sm truncate text-zinc-800 dark:text-zinc-100">
                    <span v-if="form.event.main || form.event.goal">{{ form.event.main || 'â€”' }} Â· {{ form.event.goal || 'â€”' }}</span>
                    <span v-else class="text-zinc-400">ç‚¹å‡»å½•å…¥ï¼ˆæ ‡è®° / ç›®æ ‡ / é‡åŒ– / åŸå› ï¼‰</span>
                  </div>
                </button>
              </div>
            </div>
          </div>

          <!-- ç»„B -->
          <div class="p-4 sm:p-6 bg-white/60 dark:bg-black/35">
            <div>
              <div class="flex items-center justify-between">
                <label class="text-xs text-zinc-600 dark:text-zinc-300">å®Œæˆåº¦</label>
                <span class="text-sm font-medium text-zinc-800 dark:text-zinc-100">{{ form.progress }}%</span>
              </div>
              <input type="range" min="0" max="100" v-model.number="form.progress" class="w-full mt-2">
            </div>

            <div class="mt-4">
              <label class="text-xs text-zinc-600 dark:text-zinc-300">å›é¡¾æ€»ç»“</label>
              <textarea v-model="form.review" rows="5" placeholder="è®°å½•å…³é”®è¿‡ç¨‹ã€åæ€ç‚¹ã€æƒ…ç»ªæ³¢åŠ¨ç­‰ï¼ˆæ”¯æŒ Markdown ç®€å•è¯­æ³•ï¼‰"
                        class="mt-1 w-full rounded-lg glass dark:glass-dark border border-white/60 dark:border-white/10 px-3 py-2 text-zinc-800 dark:text-zinc-100"></textarea>
            </div>

            <div class="mt-4">
              <button @click="ui.showImage = !ui.showImage" class="btn"> {{ ui.showImage ? 'æ”¶èµ·å›¾ç‰‡ä¸Šä¼ ' : 'å±•å¼€å›¾ç‰‡ä¸Šä¼ ' }} </button>
              <div v-show="ui.showImage" class="mt-3">
                <div @dragover.prevent="onDragOver" @dragleave.prevent="onDragLeave" @drop.prevent="onDropFiles"
                     :class="['rounded-xl border border-dashed p-4 text-sm text-zinc-700 dark:text-zinc-300', drag.isOver ? 'border-blue-400' : 'border-white/60 dark:border-white/10', 'glass dark:glass-dark']">
                  æ”¯æŒç‚¹å‡»é€‰æ‹©ä¸æ‹–æ‹½ä¸Šä¼ 
                  <input ref="imageInput" type="file" accept="image/*" multiple class="hidden" @change="onSelectFiles">
                  <button @click="$refs.imageInput.click()" class="ml-2 btn-sm">é€‰æ‹©å›¾ç‰‡</button>
                </div>

                <div v-if="form.images.length" class="mt-3 grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 gap-3">
                  <div v-for="(img,idx) in form.images" :key="img.localId" class="relative group">
                    <img :src="img.preview" class="w-full h-24 object-cover rounded-lg border border-white/60 dark:border-white/10 glass dark:glass-dark cursor-zoom-in" @click="openLightbox(img.preview)">
                    <div class="absolute inset-0 rounded-lg bg-black/0 group-hover:bg-black/35 transition flex items-center justify-center gap-2 opacity-0 group-hover:opacity-100">
                      <button @click="removeImage(idx)" class="px-2 py-1 text-xs rounded bg-white/90 text-zinc-900">åˆ é™¤</button>
                      <button @click="replaceImage(idx)" class="px-2 py-1 text-xs rounded bg-white/90 text-zinc-900">æ›¿æ¢</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="mt-6 flex flex-wrap gap-3">
              <button @click="submitRecord" class="btn-primary">ä¿å­˜ï¼ˆCtrl+Enterï¼‰</button>
              <button @click="resetForm" class="btn">é‡ç½®</button>
              <div class="ml-auto flex items-center gap-2 text-xs text-zinc-700 dark:text-zinc-300">
                <span class="kbd">Ctrl</span> + <span class="kbd">Enter</span> æäº¤
                <span class="mx-2">|</span>
                <span class="kbd">Esc</span> å…³é—­å¼¹çª—
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- å³ï¼šè®°å½•åˆ—è¡¨ -->
      <section class="space-y-4">
        <!-- æ¦‚è§ˆ -->
        <div class="rounded-2xl glass dark:glass-dark border border-white/60 dark:border-white/10 p-4 sm:p-6 shadow-soft">
          <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
            <div><div class="text-xs text-zinc-700 dark:text-zinc-300">è®°å½•æ€»æ•°</div><div class="text-2xl font-semibold mt-1 text-zinc-900 dark:text-zinc-100">{{ records.length }}</div></div>
            <div><div class="text-xs text-zinc-700 dark:text-zinc-300">æœ¬å‘¨è€—æ—¶</div><div class="text-2xl font-semibold mt-1 text-zinc-900 dark:text-zinc-100">{{ weeklyHours }}</div></div>
            <div><div class="text-xs text-zinc-700 dark:text-zinc-300">æ ‡ç­¾æ•°</div><div class="text-2xl font-semibold mt-1 text-zinc-900 dark:text-zinc-100">{{ uniqueTags.size }}</div></div>
            <div><div class="text-xs text-zinc-700 dark:text-zinc-300">ä¸Šæ¬¡åŒæ­¥</div><div class="text-sm mt-1 truncate text-zinc-900 dark:text-zinc-100">{{ sync.lastSync ? formatDateTime(sync.lastSync) : 'â€”' }}</div></div>
          </div>
        </div>

        <!-- åˆ—è¡¨ -->
        <div class="rounded-2xl glass dark:glass-dark border border-white/60 dark:border-white/10 p-2 sm:p-4 shadow-soft">
          <div v-if="filteredRecords.length === 0" class="p-6 text-sm text-zinc-700 dark:text-zinc-300 text-center">æš‚æ— è®°å½•</div>

          <article v-for="r in filteredRecords" :key="r.id"
                   class="record-card rounded-xl glass dark:glass-dark border border-white/60 dark:border-white/10 p-3 sm:p-4 mb-2 focus-within:ring-2 ring-white/60 dark:ring-white/20">
            <!-- ç¬¬ä¸€è¡Œ -->
            <div class="flex flex-wrap items-center gap-x-3 gap-y-1 cursor-pointer" @click="r._expanded = !r._expanded">
              <div class="text-sm text-zinc-700 dark:text-zinc-300">{{ r.date }}</div>
              <div class="text-sm text-zinc-900 dark:text-zinc-100">{{ r.startTime }} - {{ r.endTime }}</div>
              <div class="text-sm text-zinc-500">Â·</div>
              <div class="text-sm text-zinc-900 dark:text-zinc-100">{{ durationText(r.durationMs) }}</div>
              <div class="text-sm text-zinc-500">Â·</div>
              <div class="text-sm px-2 py-0.5 rounded border border-white/60 dark:border-white/10 glass dark:glass-dark text-zinc-900 dark:text-zinc-100">{{ r.type }}</div>
              <div class="text-sm text-zinc-500">Â·</div>
              <div class="text-sm text-zinc-900 dark:text-zinc-100">å®Œæˆåº¦ {{ r.progress }}%</div>

              <div class="ml-auto flex items-center gap-2 card-actions">
                <button @click.stop="startEdit(r)" class="btn-sm">ç¼–è¾‘</button>
                <button @click.stop="deleteRecord(r.id)" class="btn-sm text-red-600 border-red-300">åˆ é™¤</button>
                <button @click.stop="r._expanded = !r._expanded" class="btn-sm">{{ r._expanded ? 'æ”¶èµ·' : 'å±•å¼€' }}</button>
              </div>
            </div>

            <!-- ç¬¬äºŒè¡Œï¼šäº‹ä»¶é¢„è§ˆï¼ˆ8ä¸ªå­—ç‹¬ç«‹æ ·å¼ï¼‰ -->
            <div class="mt-2 text-sm space-y-1">
              <div v-if="r.event?.main"><span class="font-semibold text-zinc-600 dark:text-zinc-300">æ ‡è®°ï¼š</span><span class="text-zinc-900 dark:text-zinc-100">{{ r.event.main }}</span></div>
              <div v-if="r.event?.goal"><span class="font-semibold text-zinc-600 dark:text-zinc-300">ç›®æ ‡ï¼š</span><span class="text-zinc-900 dark:text-zinc-100">{{ r.event.goal }}</span></div>
              <div v-if="r.event?.metric"><span class="font-semibold text-zinc-600 dark:text-zinc-300">é‡åŒ–ï¼š</span><span class="text-zinc-900 dark:text-zinc-100">{{ r.event.metric }}</span></div>
              <div v-if="r.event?.reason"><span class="font-semibold text-zinc-600 dark:text-zinc-300">åŸå› ï¼š</span><span class="text-zinc-900 dark:text-zinc-100">{{ r.event.reason }}</span></div>
            </div>

            <!-- å±•å¼€è¯¦æƒ… -->
            <div v-show="r._expanded" class="mt-3 grid grid-cols-1 gap-3">
              <div v-if="r.tags?.length" class="flex flex-wrap gap-1">
                <span v-for="t in r.tags" :key="t" class="text-xs px-2 py-0.5 rounded-full border border-white/60 dark:border-white/10 glass dark:glass-dark text-zinc-800 dark:text-zinc-100">{{ t }}</span>
              </div>

              <div v-if="r.review" class="prose prose-zinc dark:prose-invert max-w-none text-sm">
                <div class="text-zinc-600 dark:text-zinc-300">å›é¡¾æ€»ç»“</div>
                <div class="mt-1 whitespace-pre-wrap text-zinc-900 dark:text-zinc-100">{{ r.review }}</div>
              </div>

              <div v-if="r.images && r.images.length" class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 gap-3">
                <img v-for="img in r.images" :key="img.id" :src="img.preview || img.url"
                     class="w-full h-24 object-cover rounded-lg border border-white/60 dark:border-white/10 glass dark:glass-dark cursor-zoom-in"
                     @click="openLightbox(img.preview || img.url)" />
              </div>
            </div>
          </article>
        </div>
      </section>
    </main>

    <!-- äº‹ä»¶å¼¹çª— -->
    <div v-show="ui.showEventModal" class="fixed inset-0 z-40 flex items-center justify-center p-4" @keydown.esc="ui.showEventModal=false">
      <div class="absolute inset-0 bg-black/40" @click="ui.showEventModal=false"></div>
      <div class="relative w-full max-w-lg rounded-2xl glass dark:glass-dark border border-white/60 dark:border-white/10 p-4 sm:p-6 shadow-soft">
        <div class="flex items-center justify-between">
          <h3 class="text-lg font-semibold text-zinc-900 dark:text-zinc-100">äº‹ä»¶ä¿¡æ¯</h3>
          <button @click="ui.showEventModal=false" class="btn-sm">å…³é—­ï¼ˆEscï¼‰</button>
        </div>
        <div class="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-3">
          <div><label class="text-sm text-zinc-600 dark:text-zinc-300">æ ‡è®°ï¼ˆä¸»åˆ†ç±»ï¼‰</label><input v-model="form.event.main" class="mt-1 w-full rounded-lg glass dark:glass-dark border border-white/60 dark:border-white/10 px-3 py-2 text-zinc-900 dark:text-zinc-100"></div>
          <div><label class="text-sm text-zinc-600 dark:text-zinc-300">ç›®æ ‡ï¼ˆè¡Œä¸ºç›®çš„ï¼‰</label><input v-model="form.event.goal" class="mt-1 w-full rounded-lg glass dark:glass-dark border border-white/60 dark:border-white/10 px-3 py-2 text-zinc-900 dark:text-zinc-100"></div>
          <div><label class="text-sm text-zinc-600 dark:text-zinc-300">é‡åŒ–ï¼ˆå¯è¡¡é‡æŒ‡æ ‡ï¼‰</label><input v-model="form.event.metric" class="mt-1 w-full rounded-lg glass dark:glass-dark border border-white/60 dark:border-white/10 px-3 py-2 text-zinc-900 dark:text-zinc-100"></div>
          <div><label class="text-sm text-zinc-600 dark:text-zinc-300">åŸå› ï¼ˆåŠ¨æœºæˆ–èƒŒæ™¯ï¼‰</label><input v-model="form.event.reason" class="mt-1 w-full rounded-lg glass dark:glass-dark border border-white/60 dark:border-white/10 px-3 py-2 text-zinc-900 dark:text-zinc-100"></div>
        </div>
        <div class="mt-4 flex items-center justify-end gap-2">
          <button @click="ui.showEventModal=false" class="btn">å®Œæˆ</button>
        </div>
      </div>
    </div>

    <!-- è®¾ç½®å¼¹çª—ï¼ˆWebDAVï¼‰ -->
    <div v-show="ui.showSettings" class="fixed inset-0 z-40 flex items-center justify-center p-4" @keydown.esc="ui.showSettings=false">
      <div class="absolute inset-0 bg-black/40" @click="ui.showSettings=false"></div>
      <div class="relative w-full max-w-2xl rounded-2xl glass dark:glass-dark border border-white/60 dark:border-white/10 p-4 sm:p-6 shadow-soft">
        <div class="flex items-center justify-between">
          <h3 class="text-lg font-semibold text-zinc-900 dark:text-zinc-100">äº‘åŒæ­¥è®¾ç½®ï¼ˆWebDAV Â· AListï¼‰</h3>
          <button @click="ui.showSettings=false" class="btn-sm">å…³é—­</button>
        </div>
        <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-3">
          <div><label class="text-sm text-zinc-600 dark:text-zinc-300">WebDAV åœ°å€</label><input v-model="settings.webdav.url" placeholder="https://your-alist.example/webdav" class="mt-1 w-full rounded-lg glass dark:glass-dark border border-white/60 dark:border-white/10 px-3 py-2 text-zinc-900 dark:text-zinc-100"></div>
          <div><label class="text-sm text-zinc-600 dark:text-zinc-300">æ ¹ç›®å½•</label><input v-model="settings.webdav.root" placeholder="/behavior-journal/" class="mt-1 w-full rounded-lg glass dark:glass-dark border border-white/60 dark:border-white/10 px-3 py-2 text-zinc-900 dark:text-zinc-100"></div>
          <div><label class="text-sm text-zinc-600 dark:text-zinc-300">ç”¨æˆ·å</label><input v-model="settings.webdav.username" class="mt-1 w-full rounded-lg glass dark:glass-dark border border-white/60 dark:border-white/10 px-3 py-2 text-zinc-900 dark:text-zinc-100"></div>
          <div><label class="text-sm text-zinc-600 dark:text-zinc-300">å¯†ç æˆ– Token</label><input v-model="settings.webdav.password" type="password" class="mt-1 w-full rounded-lg glass dark:glass-dark border border-white/60 dark:border-white/10 px-3 py-2 text-zinc-900 dark:text-zinc-100"></div>
          <div><label class="text-sm text-zinc-600 dark:text-zinc-300">è®¾å¤‡æ ‡è¯†ï¼ˆUUIDï¼‰</label><input v-model="settings.deviceId" readonly class="mt-1 w-full rounded-lg bg-white/40 dark:bg-black/30 border border-white/60 dark:border-white/10 px-3 py-2 text-zinc-900 dark:text-zinc-100"></div>
          <div><label class="text-sm text-zinc-600 dark:text-zinc-300">åŒæ­¥æ¨¡å¼</label><select v-model="settings.syncMode" class="mt-1 w-full rounded-lg glass dark:glass-dark border border-white/60 dark:border-white/10 px-3 py-2 text-zinc-900 dark:text-zinc-100"><option value="manual">æ‰‹åŠ¨</option><option value="onSave">ä¿å­˜å³åŒæ­¥</option><option value="interval">å®šæ—¶åŒæ­¥</option></select></div>
          <div class="flex items-center gap-2 md:col-span-2">
            <input id="remember" type="checkbox" v-model="settings.remember" class="rounded border-white/60 dark:border-white/10">
            <label for="remember" class="text-sm text-zinc-700 dark:text-zinc-300">è®°ä½æˆ‘ï¼ˆå°†å‡­æ®ä¿å­˜åˆ° localStorageï¼‰</label>
          </div>
          <div><label class="text-sm text-zinc-600 dark:text-zinc-300">å®šæ—¶é—´éš”ï¼ˆåˆ†é’Ÿï¼‰</label><input type="number" min="5" v-model.number="settings.intervalMinutes" class="mt-1 w-full rounded-lg glass dark:glass-dark border border-white/60 dark:border-white/10 px-3 py-2 text-zinc-900 dark:text-zinc-100"></div>
        </div>
        <div class="mt-4 flex items-center gap-2">
          <button @click="testWebDAV" class="btn">æµ‹è¯•è¿æ¥</button>
          <button @click="ui.showSettings=false" class="btn-primary">ä¿å­˜</button>
        </div>
      </div>
    </div>

    <!-- å›¾ç‰‡æŸ¥çœ‹ Lightbox -->
    <div v-show="lightbox.show" class="fixed inset-0 z-50 flex items-center justify-center bg-black/70" @click="closeLightbox">
      <img :src="lightbox.src" class="max-w-[92vw] max-h-[92vh] rounded-xl border border-white/20 shadow-soft" @click.stop>
    </div>

  </div>

  <script src="main.js"></script>
  <script>(function(){ if(localStorage.getItem('bj.dark')==='1') document.documentElement.classList.add('dark'); })();</script>
</body>
</html>
